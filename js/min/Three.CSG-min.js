THREE.CSG={toCSG:function(e,r,t){var c,a,r,s,o,n;if(!CSG)throw"CSG library not loaded. Please get a copy from https://github.com/evanw/csg.js";if(e instanceof THREE.Mesh)a=e.geometry,r=r||e.position,t=t||e.rotation;else{if(!(e instanceof THREE.Geometry))throw"Model type not supported.";a=e,r=r||new THREE.Vector3(0,0,0),t=t||new THREE.Vector3(0,0,0)}n=(new THREE.Matrix4).setRotationFromEuler(t);var s=[];for(c=0;c<a.faces.length;c++)if(a.faces[c]instanceof THREE.Face3)o=[],o.push(new CSG.Vertex(n.multiplyVector3(a.vertices[a.faces[c].a].clone().addSelf(r)),[a.faces[c].normal.x,a.faces[c].normal.y,a.faces[c].normal.z],[a.faceVertexUvs[0][c][0].u,a.faceVertexUvs[0][c][0].v,0])),o.push(new CSG.Vertex(n.multiplyVector3(a.vertices[a.faces[c].b].clone().addSelf(r)),[a.faces[c].normal.x,a.faces[c].normal.y,a.faces[c].normal.z],[a.faceVertexUvs[0][c][1].u,a.faceVertexUvs[0][c][1].v,0])),o.push(new CSG.Vertex(n.multiplyVector3(a.vertices[a.faces[c].c].clone().addSelf(r)),[a.faces[c].normal.x,a.faces[c].normal.y,a.faces[c].normal.z],[a.faceVertexUvs[0][c][2].u,a.faceVertexUvs[0][c][2].v,0])),s.push(new CSG.Polygon(o));else{if(!(a.faces[c]instanceof THREE.Face4))throw"Model contains unsupported face.";o=[],o.push(new CSG.Vertex(n.multiplyVector3(a.vertices[a.faces[c].a].clone().addSelf(r)),[a.faces[c].normal.x,a.faces[c].normal.y,a.faces[c].normal.z],[a.faceVertexUvs[0][c][0].u,a.faceVertexUvs[0][c][0].v,0])),o.push(new CSG.Vertex(n.multiplyVector3(a.vertices[a.faces[c].b].clone().addSelf(r)),[a.faces[c].normal.x,a.faces[c].normal.y,a.faces[c].normal.z],[a.faceVertexUvs[0][c][1].u,a.faceVertexUvs[0][c][1].v,0])),o.push(new CSG.Vertex(n.multiplyVector3(a.vertices[a.faces[c].d].clone().addSelf(r)),[a.faces[c].normal.x,a.faces[c].normal.y,a.faces[c].normal.z],[a.faceVertexUvs[0][c][3].u,a.faceVertexUvs[0][c][3].v,0])),s.push(new CSG.Polygon(o)),o=[],o.push(new CSG.Vertex(n.multiplyVector3(a.vertices[a.faces[c].b].clone().addSelf(r)),[a.faces[c].normal.x,a.faces[c].normal.y,a.faces[c].normal.z],[a.faceVertexUvs[0][c][1].u,a.faceVertexUvs[0][c][1].v,0])),o.push(new CSG.Vertex(n.multiplyVector3(a.vertices[a.faces[c].c].clone().addSelf(r)),[a.faces[c].normal.x,a.faces[c].normal.y,a.faces[c].normal.z],[a.faceVertexUvs[0][c][2].u,a.faceVertexUvs[0][c][2].v,0])),o.push(new CSG.Vertex(n.multiplyVector3(a.vertices[a.faces[c].d].clone().addSelf(r)),[a.faces[c].normal.x,a.faces[c].normal.y,a.faces[c].normal.z],[a.faceVertexUvs[0][c][3].u,a.faceVertexUvs[0][c][3].v,0])),s.push(new CSG.Polygon(o))}return CSG.fromPolygons(s)},fromCSG:function(e){var r,t,c,a,s=new THREE.Geometry,o=e.toPolygons();if(!CSG)throw"CSG library not loaded. Please get a copy from https://github.com/evanw/csg.js";for(r=0;r<o.length;r++){for(c=[],t=0;t<o[r].vertices.length;t++)c.push(this.getGeometryVertice(s,o[r].vertices[t].pos));c[0]===c[c.length-1]&&c.pop();for(var t=2;t<c.length;t++)a=new THREE.Face3(c[0],c[t-1],c[t],(new THREE.Vector3).copy(o[r].plane.normal)),s.faces.push(a),s.faceVertexUvs[0].push([new THREE.UV(o[r].vertices[0].uv.x,o[r].vertices[0].uv.y),new THREE.UV(o[r].vertices[t-1].uv.x,o[r].vertices[t-1].uv.y),new THREE.UV(o[r].vertices[t].uv.x,o[r].vertices[t].uv.y)])}return s.computeBoundingBox(),s},getGeometryVertice:function(e,r){var t;for(t=0;t<e.vertices.length;t++)if(e.vertices[t].x===r.x&&e.vertices[t].y===r.y&&e.vertices[t].z===r.z)return t;return e.vertices.push(new THREE.Vector3(r.x,r.y,r.z)),e.vertices.length-1}};